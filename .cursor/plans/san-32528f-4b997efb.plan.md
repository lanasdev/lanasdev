---
name: Sanity-driven SEO + dynamic OG images
overview: ""
todos:
  - id: 5edbe952-4f6b-4e76-91b3-23703922c958
    content: Create reusable seoType object schema
    status: pending
  - id: 87eb999f-fd76-4a3b-a4d0-4453da13d5b9
    content: Create ogConfigType and siteSettingsType schemas
    status: pending
  - id: b6c7a786-61aa-4bae-8d73-dea5ce7e6a7e
    content: Update about/post/project to use seoType; add seo to home
    status: pending
  - id: a7f018f8-65f4-491a-a871-917e35b11ad6
    content: Export new types in schema index; add structure settings entry
    status: pending
  - id: de854556-0f4c-4287-a30c-bfe8718ba28e
    content: Add getSiteSettings; extend existing queries to include seo fields
    status: pending
  - id: 6752293d-f336-43e5-b480-8a8edd9d0e69
    content: Unify site URL and defaults in lib/sanity-metadata.ts
    status: pending
  - id: e4000b8d-e61b-43aa-8c42-be65cdc3affd
    content: Use generatePageMetadata() in home page
    status: pending
  - id: 7b523920-f85c-47ef-9476-08441170cbdb
    content: Add lib/og.tsx cover renderer with overlay
    status: pending
  - id: b6c8381d-a539-425c-88f5-ddf2720db319
    content: Add opengraph-image.tsx for home/blog/blog[slug]/projekt/projekt[slug]/ueber
    status: pending
  - id: 0a9adaef-38d2-42a9-a068-4fd07a974fd7
    content: Set NEXT_PUBLIC_SITE_URL and OG fallbacks
    status: pending
  - id: 01755645-66ee-4ae9-98dd-07956e95607d
    content: Run pnpm typegen, typecheck, and build
    status: pending
---

# Sanity-driven SEO + dynamic OG images

## What weâ€™ll do

- Create reusable `seo` and `ogConfig` schema types and a single `siteSettings` document to centralize defaults and per-path OG config (home, blog, projekt, ueber).
- Update existing document types to use the shared `seo` type, add `seo` to `home`.
- Unify metadata generation via `lib/sanity-metadata.ts` and `NEXT_PUBLIC_SITE_URL`.
- Implement dynamic OG images with a shared renderer using the cover image + dark overlay style (2b), using image palette fallbacks.
- Add `opengraph-image.tsx` to relevant routes and fetch data from Sanity.
- Verify via typegen, typecheck, and build.

## Files to add/update

- Add: `sanity/schemaTypes/seoType.ts` (object, reusable), `sanity/schemaTypes/ogConfigType.ts` (object), `sanity/schemaTypes/siteSettingsType.ts` (document, `_id == "siteSettings"`).
- Update: `sanity/schemaTypes/{aboutType,postType,projectType,homeType}.ts` to use `type: "seo"` and add `seo` to `home`.
- Update: `sanity/schemaTypes/index.ts` to export new types; optionally add a Settings item in `sanity/structure.ts`.
- Add queries: `getSiteSettings` and extend existing queries to include `seo` where used in `lib/sanity.ts`.
- Update: `lib/sanity-metadata.ts` to honor `siteSettings.defaults` and `NEXT_PUBLIC_SITE_URL`.
- Add: `lib/og.tsx` a small helper to render an `ImageResponse` in cover style with overlay.
- Add route metadata images:
  - `app/opengraph-image.tsx` (home)
  - `app/(app)/blog/opengraph-image.tsx` (blog index)
  - `app/(app)/blog/[slug]/opengraph-image.tsx` (post)
  - `app/(app)/projekt/opengraph-image.tsx` (projects index if present)
  - Replace `app/(app)/projekt/[slug]/opengraph-image.tsx` with Sanity-powered version
  - `app/(app)/ueber/opengraph-image.tsx`
- Update: `app/(app)/layout.tsx` to keep only `metadataBase` and site name; move page-level SEO to per-route `generateMetadata`.
- Update: `app/(app)/page.tsx` to export `generateMetadata()` using `home.seo` + `siteSettings.defaults` via `generatePageMetadata`.

## Key snippets (concise)

- Reusable SEO object type:
```ts
// sanity/schemaTypes/seoType.ts
export const seoType = defineType({
  name: 'seo', title: 'SEO', type: 'object',
  fields: [
    defineField({ name: 'title', type: 'string' }),
    defineField({ name: 'description', type: 'text', rows: 3 }),
    defineField({ name: 'image', type: 'image', options: { hotspot: true } }),
    defineField({
      name: 'indexing', type: 'string', initialValue: 'index',
      options: { list: [ {title:'Index', value:'index'}, {title:'No index', value:'noindex'} ], layout: 'radio' }
    })
  ]
})
```

- OG cover renderer usage in a route (pattern):
```ts
// app/(app)/blog/[slug]/opengraph-image.tsx
export const runtime = 'edge'
export const size = { width: 1200, height: 630 }
export const contentType = 'image/png'
import { client } from '@/sanity/lib/client'
import { ImageResponse } from 'next/og'
const QUERY = `*[_type=='post' && slug.current==$slug][0]{ title, mainImage{ asset->{ url, metadata{ palette } } } }`
export default async function Image({ params }: { params: { slug: string } }) {
  const data = await client.fetch(QUERY, { slug: params.slug })
  const bg = data?.mainImage?.asset?.metadata?.palette?.darkVibrant?.background || '#111'
  const url = data?.mainImage?.asset?.url
  return new ImageResponse(/* cover + overlay + title */)
}
```


## Acceptance criteria

- Authors can manage global defaults and per-path OG settings in `siteSettings`.
- `home`, `ueber`, post, project pages render correct, canonical metadata from Sanity; robots reflect indexing choice.
- OG images render dynamically per path with cover style and dark overlay; fallbacks work when no image is set.
- Build passes: `pnpm typegen`, `pnpm typecheck`, `pnpm build`.