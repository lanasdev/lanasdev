<!-- 4b997efb-c891-4a88-ae31-22f6fab79181 5459847a-62fa-49f9-99d2-76c32d6e5706 -->
# Sanity-driven SEO + dynamic OG images

## What weâ€™ll do

- Create reusable `seo` and `ogConfig` schema types and a single `siteSettings` document to centralize defaults and per-path OG config (home, blog, projekt, ueber).
- Update existing document types to use the shared `seo` type, add `seo` to `home`.
- Unify metadata generation via `lib/sanity-metadata.ts` and `NEXT_PUBLIC_SITE_URL`.
- Implement dynamic OG images with a shared renderer using the cover image + dark overlay style (2b), using image palette fallbacks.
- Add `opengraph-image.tsx` to relevant routes and fetch data from Sanity.
- Verify via typegen, typecheck, and build.

## Files to add/update

- Add: `sanity/schemaTypes/seoType.ts` (object, reusable), `sanity/schemaTypes/ogConfigType.ts` (object), `sanity/schemaTypes/siteSettingsType.ts` (document, `_id == "siteSettings"`).
- Update: `sanity/schemaTypes/{aboutType,postType,projectType,homeType}.ts` to use `type: "seo"` and add `seo` to `home`.
- Update: `sanity/schemaTypes/index.ts` to export new types; optionally add a Settings item in `sanity/structure.ts`.
- Add queries: `getSiteSettings` and extend existing queries to include `seo` where used in `lib/sanity.ts`.
- Update: `lib/sanity-metadata.ts` to honor `siteSettings.defaults` and `NEXT_PUBLIC_SITE_URL`.
- Add: `lib/og.tsx` a small helper to render an `ImageResponse` in cover style with overlay.
- Add route metadata images:
  - `app/opengraph-image.tsx` (home)
  - `app/(app)/blog/opengraph-image.tsx` (blog index)
  - `app/(app)/blog/[slug]/opengraph-image.tsx` (post)
  - `app/(app)/projekt/opengraph-image.tsx` (projects index if present)
  - Replace `app/(app)/projekt/[slug]/opengraph-image.tsx` with Sanity-powered version
  - `app/(app)/ueber/opengraph-image.tsx`
- Update: `app/(app)/layout.tsx` to keep only `metadataBase` and site name; move page-level SEO to per-route `generateMetadata`.
- Update: `app/(app)/page.tsx` to export `generateMetadata()` using `home.seo` + `siteSettings.defaults` via `generatePageMetadata`.

## Key snippets (concise)

- Reusable SEO object type:
```ts
// sanity/schemaTypes/seoType.ts
export const seoType = defineType({
  name: 'seo', title: 'SEO', type: 'object',
  fields: [
    defineField({ name: 'title', type: 'string' }),
    defineField({ name: 'description', type: 'text', rows: 3 }),
    defineField({ name: 'image', type: 'image', options: { hotspot: true } }),
    defineField({
      name: 'indexing', type: 'string', initialValue: 'index',
      options: { list: [ {title:'Index', value:'index'}, {title:'No index', value:'noindex'} ], layout: 'radio' }
    })
  ]
})
```

- OG cover renderer usage in a route (pattern):
```ts
// app/(app)/blog/[slug]/opengraph-image.tsx
export const runtime = 'edge'
export const size = { width: 1200, height: 630 }
export const contentType = 'image/png'
import { client } from '@/sanity/lib/client'
import { ImageResponse } from 'next/og'
const QUERY = `*[_type=='post' && slug.current==$slug][0]{ title, mainImage{ asset->{ url, metadata{ palette } } } }`
export default async function Image({ params }: { params: { slug: string } }) {
  const data = await client.fetch(QUERY, { slug: params.slug })
  const bg = data?.mainImage?.asset?.metadata?.palette?.darkVibrant?.background || '#111'
  const url = data?.mainImage?.asset?.url
  return new ImageResponse(/* cover + overlay + title */)
}
```


## Acceptance criteria

- Authors can manage global defaults and per-path OG settings in `siteSettings`.
- `home`, `ueber`, post, project pages render correct, canonical metadata from Sanity; robots reflect indexing choice.
- OG images render dynamically per path with cover style and dark overlay; fallbacks work when no image is set.
- Build passes: `pnpm typegen`, `pnpm typecheck`, `pnpm build`.

### To-dos

- [ ] Create reusable seoType object schema
- [ ] Create ogConfigType and siteSettingsType schemas
- [ ] Update about/post/project to use seoType; add seo to home
- [ ] Export new types in schema index; add structure settings entry
- [ ] Add getSiteSettings; extend existing queries to include seo fields
- [ ] Unify site URL and defaults in lib/sanity-metadata.ts
- [ ] Use generatePageMetadata() in home page
- [ ] Add lib/og.tsx cover renderer with overlay
- [ ] Add opengraph-image.tsx for home/blog/blog[slug]/projekt/projekt[slug]/ueber
- [ ] Set NEXT_PUBLIC_SITE_URL and OG fallbacks
- [ ] Run pnpm typegen, typecheck, and build